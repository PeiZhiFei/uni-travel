import{c as t,w as e,d as o,b as d,z as i,H as l,V as n,i as s,o as a,j as c,k as h,q as r,y as u,r as f,l as p,n as g,p as N,t as C,F as m,u as x,I as y}from"./index-ONQ8qMAl.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=T({data:()=>({rootNode:null,selectedNode:null,offsetX:0,offsetY:0,isDragging:!1,lastTouchX:0,lastTouchY:0,showEditModal:!1,showAddModal:!1,editNodeText:"",newNodeText:"",editingNode:null,addingToNode:null,nodeIdCounter:0,nodeConfig:{rootWidth:140,rootHeight:70,childWidth:120,childHeight:60,horizontalSpacing:180,verticalSpacing:100,addButtonSize:32}}),onLoad(){this.initMindmap()},methods:{initMindmap(){const t=n().windowWidth/2;this.rootNode={id:this.nodeIdCounter++,text:"中心主题",x:t,y:150,width:this.nodeConfig.rootWidth,height:this.nodeConfig.rootHeight,children:[],parent:null,level:0}},getAllChildren(t){let e=[];const o=t=>{t.children&&t.children.forEach(t=>{e.push(t),o(t)})};return o(t),e},getNodeStyle:t=>({left:t.x-t.width/2+"px",top:t.y-t.height/2+"px",width:t.width+"px",height:t.height+"px"}),getAddButtonStyle(t){const e=t.x+t.width/2+12,o=t.y;return{left:e-this.nodeConfig.addButtonSize/2+"px",top:o-this.nodeConfig.addButtonSize/2+"px",width:this.nodeConfig.addButtonSize+"px",height:this.nodeConfig.addButtonSize+"px"}},getDeleteButtonStyle(t){const e=t.x-t.width/2-12,o=t.y;return{left:e-this.nodeConfig.addButtonSize/2+"px",top:o-this.nodeConfig.addButtonSize/2+"px",width:this.nodeConfig.addButtonSize+"px",height:this.nodeConfig.addButtonSize+"px"}},getLineStyle(t){if(!t.parent)return{};const e=t.parent,o=e.x,d=e.y+e.height/2,i=t.x-o,l=t.y-t.height/2-d;return{left:o+"px",top:d+"px",width:Math.sqrt(i*i+l*l)+"px",transform:`rotate(${180*Math.atan2(l,i)/Math.PI}deg)`,transformOrigin:"0 0"}},selectNode(t){this.selectedNode=t},addChildNode(t){this.addingToNode=t,this.newNodeText="",this.showAddModal=!0},confirmAdd(){if(!this.addingToNode||!this.newNodeText.trim())return void this.closeAddModal();const t=this.addingToNode,e=t.level+1,o=t.children.length,d=o*this.nodeConfig.horizontalSpacing,i=t.x-d/2+o*this.nodeConfig.horizontalSpacing,l=t.y+this.nodeConfig.verticalSpacing,n={id:this.nodeIdCounter++,text:this.newNodeText.trim(),x:i,y:l,width:this.nodeConfig.childWidth,height:this.nodeConfig.childHeight,children:[],parent:t,level:e};t.children.push(n),this.closeAddModal()},closeAddModal(){this.showAddModal=!1,this.newNodeText="",this.addingToNode=null},editNode(t){this.editingNode=t,this.editNodeText=t.text,this.showEditModal=!0},confirmEdit(){this.editingNode&&this.editNodeText.trim()&&(this.editingNode.text=this.editNodeText.trim()),this.closeEditModal()},closeEditModal(){this.showEditModal=!1,this.editNodeText="",this.editingNode=null},deleteNode(t){t!==this.rootNode?l({title:"确认删除",content:"确定要删除这个节点及其所有子节点吗？",success:e=>{if(e.confirm){const e=t.parent;if(e&&e.children){const o=e.children.indexOf(t);o>-1&&e.children.splice(o,1)}this.selectedNode&&this.selectedNode.id===t.id&&(this.selectedNode=null)}}}):l({title:"提示",content:"不能删除根节点，可以编辑其内容",showCancel:!1})},onTouchStart(t){1===t.touches.length&&(this.isDragging=!0,this.lastTouchX=t.touches[0].clientX,this.lastTouchY=t.touches[0].clientY)},onTouchMove(t){if(this.isDragging&&1===t.touches.length){const e=t.touches[0].clientX-this.lastTouchX,o=t.touches[0].clientY-this.lastTouchY;this.offsetX+=e,this.offsetY+=o,this.lastTouchX=t.touches[0].clientX,this.lastTouchY=t.touches[0].clientY}},onTouchEnd(){this.isDragging=!1},resetView(){this.offsetX=0,this.offsetY=0,this.selectedNode=null},saveMindmap(){const t=JSON.stringify(this.rootNode);i("mindmapData",t),d({title:"保存成功",icon:"success"})},loadMindmap(){const t=o("mindmapData");if(t)try{this.rootNode=JSON.parse(t),this.updateNodeIdCounter(this.rootNode),this.selectedNode=null,this.resetView(),d({title:"加载成功",icon:"success"})}catch(e){d({title:"加载失败",icon:"none"})}else d({title:"没有保存的数据",icon:"none"})},updateNodeIdCounter(t){t.id>=this.nodeIdCounter&&(this.nodeIdCounter=t.id+1),t.children&&t.children.forEach(t=>{this.updateNodeIdCounter(t)})}}},[["render",function(o,d,i,l,n,T){const _=s,k=N,w=y;return a(),t(_,{class:"mindmap-container"},{default:e(()=>[c(_,{class:"toolbar"},{default:e(()=>[c(_,{class:"toolbar-item",onClick:T.resetView},{default:e(()=>[r("重置视图")]),_:1},8,["onClick"]),c(_,{class:"toolbar-item",onClick:T.saveMindmap},{default:e(()=>[r("保存")]),_:1},8,["onClick"]),c(_,{class:"toolbar-item",onClick:T.loadMindmap},{default:e(()=>[r("加载")]),_:1},8,["onClick"])]),_:1}),c(_,{class:"mindmap-wrapper",onTouchstart:T.onTouchStart,onTouchmove:T.onTouchMove,onTouchend:T.onTouchEnd,style:u({transform:`translate(${n.offsetX}px, ${n.offsetY}px)`})},{default:e(()=>[n.rootNode?(a(),t(_,{key:0,class:"node-wrapper",style:u(T.getNodeStyle(n.rootNode))},{default:e(()=>[c(_,{class:g(["node root-node",{"node-selected":n.selectedNode&&n.selectedNode.id===n.rootNode.id}]),onClick:d[0]||(d[0]=p(t=>T.selectNode(n.rootNode),["stop"])),onLongpress:d[1]||(d[1]=t=>T.editNode(n.rootNode))},{default:e(()=>[c(k,{class:"node-text"},{default:e(()=>[r(C(n.rootNode.text),1)]),_:1})]),_:1},8,["class"]),c(_,{class:"action-button add-button",style:u(T.getAddButtonStyle(n.rootNode)),onClick:d[2]||(d[2]=p(t=>T.addChildNode(n.rootNode),["stop"]))},{default:e(()=>[c(k,{class:"action-icon"},{default:e(()=>[r("+")]),_:1})]),_:1},8,["style"]),n.rootNode.children&&n.rootNode.children.length>0?(a(),t(_,{key:0,class:"action-button delete-button",style:u(T.getDeleteButtonStyle(n.rootNode)),onClick:d[3]||(d[3]=p(t=>T.deleteNode(n.rootNode),["stop"]))},{default:e(()=>[c(k,{class:"action-icon"},{default:e(()=>[r("−")]),_:1})]),_:1},8,["style"])):h("",!0)]),_:1},8,["style"])):h("",!0),n.rootNode?(a(!0),f(m,{key:1},x(T.getAllChildren(n.rootNode),o=>(a(),t(_,{key:o.id,class:"node-wrapper",style:u(T.getNodeStyle(o))},{default:e(()=>[c(_,{class:"node-line",style:u(T.getLineStyle(o))},null,8,["style"]),c(_,{class:g(["node child-node",{"node-selected":n.selectedNode&&n.selectedNode.id===o.id}]),onClick:p(t=>T.selectNode(o),["stop"]),onLongpress:t=>T.editNode(o)},{default:e(()=>[c(k,{class:"node-text"},{default:e(()=>[r(C(o.text),1)]),_:2},1024)]),_:2},1032,["class","onClick","onLongpress"]),c(_,{class:"action-button add-button",style:u(T.getAddButtonStyle(o)),onClick:p(t=>T.addChildNode(o),["stop"])},{default:e(()=>[c(k,{class:"action-icon"},{default:e(()=>[r("+")]),_:1})]),_:2},1032,["style","onClick"]),c(_,{class:"action-button delete-button",style:u(T.getDeleteButtonStyle(o)),onClick:p(t=>T.deleteNode(o),["stop"])},{default:e(()=>[c(k,{class:"action-icon"},{default:e(()=>[r("−")]),_:1})]),_:2},1032,["style","onClick"])]),_:2},1032,["style"]))),128)):h("",!0)]),_:1},8,["onTouchstart","onTouchmove","onTouchend","style"]),n.showEditModal?(a(),t(_,{key:0,class:"modal",onClick:p(T.closeEditModal,["stop"])},{default:e(()=>[c(_,{class:"modal-content",onClick:d[5]||(d[5]=p(()=>{},["stop"]))},{default:e(()=>[c(_,{class:"modal-title"},{default:e(()=>[r("编辑节点")]),_:1}),c(w,{class:"modal-input",modelValue:n.editNodeText,"onUpdate:modelValue":d[4]||(d[4]=t=>n.editNodeText=t),placeholder:"输入节点文本",onConfirm:T.confirmEdit},null,8,["modelValue","onConfirm"]),c(_,{class:"modal-buttons"},{default:e(()=>[c(_,{class:"modal-btn",onClick:T.confirmEdit},{default:e(()=>[r("确定")]),_:1},8,["onClick"]),c(_,{class:"modal-btn cancel",onClick:T.closeEditModal},{default:e(()=>[r("取消")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])):h("",!0),n.showAddModal?(a(),t(_,{key:1,class:"modal",onClick:p(T.closeAddModal,["stop"])},{default:e(()=>[c(_,{class:"modal-content",onClick:d[7]||(d[7]=p(()=>{},["stop"]))},{default:e(()=>[c(_,{class:"modal-title"},{default:e(()=>[r("添加子节点")]),_:1}),c(w,{class:"modal-input",modelValue:n.newNodeText,"onUpdate:modelValue":d[6]||(d[6]=t=>n.newNodeText=t),placeholder:"输入节点文本",onConfirm:T.confirmAdd},null,8,["modelValue","onConfirm"]),c(_,{class:"modal-buttons"},{default:e(()=>[c(_,{class:"modal-btn",onClick:T.confirmAdd},{default:e(()=>[r("确定")]),_:1},8,["onClick"]),c(_,{class:"modal-btn cancel",onClick:T.closeAddModal},{default:e(()=>[r("取消")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])):h("",!0)]),_:1})}],["__scopeId","data-v-ccd7da27"]]);export{_ as default};
