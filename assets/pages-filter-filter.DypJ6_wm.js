import{m as e,a as t,c as s,w as i,s as l,g as o,b as c,d as r,e as n,h as a,f as d,i as u,o as h,j as p,n as m,k as g,I as f,l as y,p as P,q as k,t as b,r as O,F as N,u as S,S as T,v as L}from"./index-BILJplv6.js";import{u as _}from"./global.CV3oXpuD.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=B({data:()=>({placesList:[],filterPlacesList:[],placesList2:[],isFilterOpen:!1,isSortPopupOpen:!1,filterOptions:["0全部","1免费","2收费","3换票","4一卡通","5中午休息","6周日闭馆","8需要预约","760岁免费","9工作日开"],newFilterOptions:["有视频","有公众号","有小程序","三星以上","公园年卡","小吃饭店","闲时可去","时光记忆","地铁直达","我的收藏"],newFilterOptions2:["骑行","巨幕","教堂","寺庙","民俗","长城","园林","温泉","夏日","银杏"],newFilterOptions3:["零星","一星","二星","三星","四五星","六环外","美术馆","看演出","看夜景","去拍照"],nianka:["颐和园","天坛公园","北海公园","中山公园","香山公园","景山公园","国家植物园","动物园","陶然亭公园","玉渊潭公园","百望山森林公园","双秀公园","北京国际雕塑公园","大观园","地坛公园","水立方嬉水乐园"],selectedName:"0开启筛选",sortOption:"排序选项",sortedByRating:!1,sortedByPrice:!1,sortedByLocation:!1,inputValue:"",pageSize:30,currentPage:1,hasMore:!0,lastScrollTop:0,isShow:!0,tabClickTime:0,startY:0,moveY:0,touchStatus:!1,threshold:50,scrollTop:0,noNet:!1}),computed:{...t(_,["myGlobalData","noNet","latitude","longitude"]),...e(_,["selectedPlace","source","filterItem","navIds"])},onShow(){this.noNet=_().noNet},onLoad(){this.selectedName="0开启筛选",this.sortOption="排序选项",this.sortedByRating=!1,this.sortedByPrice=!1,this.sortedByLocation=!1,this.inputValue="",this.onLoad2(!1)},onPullDownRefresh(){this.onLoad(),this.reload(),d()},onTabItemTap(e){const t=(new Date).getTime();t-this.tabClickTime<300&&(this.scrollTop=0,this.$nextTick(()=>{this.scrollTop=.1}),this.isShow=!0),this.tabClickTime=t},methods:{onLoad2(e){n({title:"加载中"});const t=_(),s=t.myGlobalData?JSON.parse(JSON.stringify(t.myGlobalData)):[];this.placesList2=e?s.reverse():s;const i=t.latitude,l=t.longitude;if(i>0&&l>0){const e=this.init(i,l);a(),this.placesList2=e,this.filterPlacesList=e}else a(),this.filterPlacesList=this.placesList2;this.loadData()},init(e,t){if(e&&t){const s=6371;return this.placesList2.map(i=>{const l=(i.latitude-e)*(Math.PI/180),o=(i.longitude-t)*(Math.PI/180),c=Math.sin(l/2)*Math.sin(l/2)+Math.cos(e*(Math.PI/180))*Math.cos(i.latitude*(Math.PI/180))*Math.sin(o/2)*Math.sin(o/2),r=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));let n=s*r;return n=parseFloat(n.toFixed(1)),{...i,distance:n}})}return this.placesList2},loadData(){const{pageSize:e,currentPage:t,filterPlacesList:s}=this,i=(t-1)*e,l=i+e,o=s.slice(i,l);o.length<e&&(this.hasMore=!1),this.placesList=this.placesList.concat(o),this.currentPage=t+1},onReachBottom(){this.hasMore&&this.loadData()},toggleFilter(){this.isFilterOpen=!this.isFilterOpen,this.isSortPopupOpen=!1},selectFilterOption(e){this.selectedName=e,this.isFilterOpen=!1,this.filterItem()},selectNewFilterOption2(e){this.selectedName="Z"+e,this.isFilterOpen=!1,this.filterItem()},filterItem(){this.clearInput();const{selectedName:e,placesList2:t}=this,s=t.filter(t=>0==Number(e[0])||"9"==e[0]&&t.time.includes("仅工作日")||"8"==e[0]&&t.time.includes("预约")||"7"==e[0]&&t.price.includes("60岁免费")||"6"==e[0]&&t.time.includes("周日闭馆")||"5"==e[0]&&t.time.includes("中午休息")||"4"==e[0]&&(t.price.includes("一卡通")||t.recomend.includes("一卡通"))||"3"==e[0]&&t.price.includes("换票")||"2"==e[0]&&this.getPriceVal(t)>0||"1"==e[0]&&0==this.getPriceVal(t)||e.includes("有视频")&&t.video&&""!=t.video||e.includes("时光记忆")&&t.type.includes("p")||e.includes("小吃饭店")&&t.type.includes("v")||e.includes("夜景")&&t.recomend.includes("夜景")||e.includes("四合院")&&t.type.includes("q")||e.includes("巨幕")&&t.recomend.includes("幕")||e.includes("民俗")&&t.type.includes("o")||e.includes("长城")&&t.title.includes("长城")||e.includes("园林")&&t.recomend.includes("园林")||e.includes("看演出")&&(t.recomend.includes("表演")||t.recomend.includes("演出"))||e.includes("去拍照")&&t.recomend.includes("适合拍照")||e.includes("骑行")&&t.recomend.includes("骑行")||e.includes("美术馆")&&(t.title.includes("美术")||t.recomend.includes("美术"))||e.includes("胡同")&&(t.title.includes("胡同")||t.recomend.includes("胡同"))||e.includes("故居")&&(t.title.includes("故居")||t.recomend.includes("故居")||t.title.includes("纪念馆")||t.recomend.includes("纪念馆"))||e.includes("教堂")&&(t.title.includes("教堂")||t.recomend.includes("教堂"))||e.includes("寺庙")&&(t.title.includes("寺")||t.recomend.includes("寺庙"))||e.includes("温泉")&&(t.recomend.includes("温泉")||t.recomend.includes("汤泉"))||e.includes("六环外")&&(Number(t.longitude)>116.706554||Number(t.longitude)<116.139816||Number(t.latitude)>40.158419||Number(t.latitude)<39.72192)||e.includes("运动健身")&&(t.recomend.includes("健身")||t.recomend.includes("锻炼")||t.recomend.includes("体育"))||e.includes("公园年卡")&&this.nianka.includes(t.title)||e.includes("夏日")&&(t.recomend.includes("肌肉")||t.recomend.includes("游泳"))||e.includes("银杏")&&(t.recomend.includes("秋天")||t.recomend.includes("银杏"))||e.includes("地铁直达")&&t.recomend.includes("地铁直达")||e.includes("闲时可去")&&t.type.includes("x")||e.includes("有公众号")&&""!=t.officalId||e.includes("有小程序")&&""!=t.appId||e.includes("我的收藏")&&(r("favorites")||[]).includes(t.title)||e.includes("三星以上")&&Number(t.rate)>2||e.includes("零星")&&0==Number(t.rate)||e.includes("一星")&&1==Number(t.rate)||e.includes("二星")&&2==Number(t.rate)||e.includes("三星")&&3==Number(t.rate)||e.includes("四五星")&&(4==Number(t.rate)||5==Number(t.rate))||t.type.includes(e[0]));"按评分排序"==this.sortOption?s.sort((e,t)=>this.sortedByRating?Number(t.rate)-Number(e.rate):Number(e.rate)-Number(t.rate)):"按价格排序"==this.sortOption?s.sort((e,t)=>this.sortedByPrice?this.getPriceVal(t)-this.getPriceVal(e):this.getPriceVal(e)-this.getPriceVal(t)):"按距离排序"==this.sortOption&&s.sort((e,t)=>(e.distance||99999)-(t.distance||99999)),this.filterPlacesList=s,this.reload()},getPriceVal(e){if(e.price&&""!=e.price&&"0"!=e.price){const t=e.price.split("，")[0].replace("元","");return Number(t)||0}return 0},resetHeader(){this.placesList=[],this.pageSize=20,this.currentPage=1,this.hasMore=!0},close(){this.isFilterOpen=!1,this.isSortPopupOpen=!1},goToMap(){const e=this.filterPlacesList;let t;t=""!=this.inputValue?this.inputValue:"0开启筛选"==this.selectedName?"全部":this.selectedName.slice(1);const s=e.map(e=>e.title);this.filterItemStore=t;const i=_();i.filterItem=t,i.navIds=s,i.source="filter",l({url:"/pages/map/map",success:function(e){console.log("跳转成功")},fail:function(e){console.error("跳转失败:",e)}})},toggleSortPopup(){this.isSortPopupOpen=!this.isSortPopupOpen,this.isFilterOpen=!1},closeSortPopup(){this.isSortPopupOpen=!1},sortByTime(){this.sortOption="按添加排序",this.sortedByRating=!this.sortedByRating,this.sortedByPrice=!1,this.sortedByLocation=!1,this.selectedName="0开启筛选",this.onLoad2(!0),this.reload()},sortByRating(){this.sortOption="按评分排序";let e=[...this.filterPlacesList];e.sort((e,t)=>this.sortedByRating?Number(e.rate)-Number(t.rate):Number(t.rate)-Number(e.rate)),this.sortedByRating=!this.sortedByRating,this.sortedByPrice=!1,this.sortedByLocation=!1,this.filterPlacesList=e,this.reload()},sortByPrice(){this.sortOption="按价格排序";let e=[...this.filterPlacesList];e.sort((e,t)=>this.sortedByPrice?this.getPriceVal(e)-this.getPriceVal(t):this.getPriceVal(t)-this.getPriceVal(e)),this.sortedByPrice=!this.sortedByPrice,this.sortedByRating=!1,this.sortedByLocation=!1,this.filterPlacesList=e,this.reload()},sortByDistance(){const e=_();e.latitude>0&&e.longitude>0?this.sort(e.latitude,e.longitude):o({type:"gcj02",success:t=>{e.latitude=t.latitude,e.longitude=t.longitude,this.sort(t.latitude,t.longitude)},fail:e=>{console.error("获取位置失败",e),c({title:"定位失败",icon:"none"})}})},sort(e,t){const s=this.init(e,t);s.sort((e,t)=>e.distance-t.distance),this.sortOption="按距离排序",this.sortedByRating=!1,this.sortedByPrice=!1,this.sortedByLocation=!0,this.placesList2=s,this.filterPlacesList=s,this.reload()},onListScroll(e){this.isSortPopupOpen=!1,this.isFilterOpen=!1;const t=e.detail.scrollTop,s=this.lastScrollTop;t-s>3?this.isShow=!1:t-s<-3&&(this.isShow=!0),this.lastScrollTop=t},onListItemClick(e){this.close();const t=_();t.selectedPlace=e,t.source="filter",l({url:"/pages/map/map",success:function(e){console.log("跳转成功")},fail:function(e){console.error("跳转失败:",e)}})},handleTouchStart(e){const t=e.changedTouches[0];this.startY=t.clientY,this.touchStatus=!0},handleTouchMove(e){if(!this.touchStatus)return;const t=e.changedTouches[0];this.moveY=t.clientY;const s=this.startY-this.moveY;Math.abs(s)>this.threshold&&(s>3?(this.isShow=!1,this.isFilterOpen=!1,this.isSortPopupOpen=!1):s<-3&&(this.isShow=!0,this.isFilterOpen=!1,this.isSortPopupOpen=!1))},handleTouchEnd(){this.touchStatus=!1},onSearchInput(e){const t=e.detail.value.trim();if(this.inputValue=t,this.selectedName="0开启筛选",this.hasMore=!1,""!=t){let e=this.placesList2.filter(e=>e.title.includes(t)||e.recomend&&e.recomend.includes(t)||e.time&&e.time.includes(t)||e.price&&e.price.includes(t));"按评分排序"==this.sortOption?e.sort((e,t)=>this.sortedByRating?Number(t.rate)-Number(e.rate):Number(e.rate)-Number(t.rate)):"按价格排序"==this.sortOption?e.sort((e,t)=>this.sortedByPrice?this.getPriceVal(t)-this.getPriceVal(e):this.getPriceVal(e)-this.getPriceVal(t)):"按距离排序"==this.sortOption&&e.sort((e,t)=>e.distance-t.distance),this.filterPlacesList=e,this.placesList=e,this.backToTop()}else this.filterPlacesList=this.placesList2,this.reload()},clearInput(){this.inputValue=""},reload(){this.resetHeader(),this.loadData(),this.backToTop()},backToTop(){this.scrollTop=0,this.$nextTick(()=>{this.scrollTop=.1}),this.isShow=!0},sliceFirst:e=>e?e.slice(1):"",need2:e=>e.time&&-1!==e.time.indexOf("预约"),getTags:e=>e.recomend?e.recomend.split("，"):[],getPrice3(e){if(""!=e.price&&"0"!=e.price){const t=e.price.split("，")[0].replace("元","");return 0==t?"免费":"￥"+t+"元"}return"免费"}}},[["render",function(e,t,l,o,c,r){const n=f,a=u,d=P,_=L,B=T;return h(),s(a,{class:"filter-page"},{default:i(()=>[p(a,{class:m(["filter-container",c.isShow?"show":"hide"])},{default:i(()=>[p(a,{class:"filter-trigger"},{default:i(()=>[p(n,{placeholder:"搜索地点",class:"search-container-input",onInput:r.onSearchInput,onClick:t[0]||(t[0]=y(()=>{},["stop"])),value:c.inputValue},null,8,["onInput","value"])]),_:1}),p(a,{class:"filter-trigger",style:{height:"40px"}},{default:i(()=>[p(d,{style:{"border-radius":"5px",padding:"5px","text-align":"center",color:"rgb(253, 253, 253)","background-color":"rgb(93, 107, 235)",width:"30%"},onClick:y(r.toggleSortPopup,["stop"])},{default:i(()=>[k(b(c.sortOption),1)]),_:1},8,["onClick"]),p(d,{style:{"border-radius":"5px",padding:"5px","text-align":"center",color:"rgb(253, 253, 253)","background-color":"rgb(9, 194, 148)","margin-left":"10px","margin-right":"10px",width:"30%"},onClick:y(r.goToMap,["stop"])},{default:i(()=>[k("筛选景点分布")]),_:1},8,["onClick"]),p(d,{style:{"border-radius":"5px",padding:"5px",color:"rgb(253, 253, 253)","text-align":"center","background-color":"rgb(26, 149, 231)",width:"30%"},onClick:y(r.toggleFilter,["stop"])},{default:i(()=>[k(b(r.sliceFirst(c.selectedName)),1)]),_:1},8,["onClick"])]),_:1}),c.isSortPopupOpen?(h(),s(a,{key:0,class:"sort-popup",onTouchmove:t[1]||(t[1]=y(()=>{},["stop","prevent"])),onClick:r.closeSortPopup},{default:i(()=>[p(a,{class:"sort-option",onClick:y(r.sortByPrice,["stop"])},{default:i(()=>[k("按价格排序")]),_:1},8,["onClick"]),p(a,{class:"sort-option",onClick:y(r.sortByDistance,["stop"])},{default:i(()=>[k("按距离排序")]),_:1},8,["onClick"]),p(a,{class:"sort-option",onClick:y(r.sortByRating,["stop"])},{default:i(()=>[k("按评分排序")]),_:1},8,["onClick"]),p(a,{class:"sort-option",onClick:y(r.sortByTime,["stop"])},{default:i(()=>[k("按添加排序")]),_:1},8,["onClick"])]),_:1},8,["onClick"])):g("",!0),c.isFilterOpen?(h(),s(a,{key:1,class:"filter-options",onTouchmove:t[2]||(t[2]=y(()=>{},["stop","prevent"])),onClick:r.close},{default:i(()=>[p(a,{class:"filter-column",style:{color:"rgb(59, 129, 235)"}},{default:i(()=>[(h(!0),O(N,null,S(c.newFilterOptions2,(e,t)=>(h(),s(a,{class:"filter-option",key:t,onClick:y(t=>r.selectNewFilterOption2(e),["stop"])},{default:i(()=>[k(b(e),1)]),_:2},1032,["onClick"]))),128))]),_:1}),p(a,{class:"filter-column",style:{color:"rgb(13, 164, 184)"}},{default:i(()=>[(h(!0),O(N,null,S(c.newFilterOptions3,(e,t)=>(h(),s(a,{class:"filter-option",key:t,onClick:y(t=>r.selectNewFilterOption2(e),["stop"])},{default:i(()=>[k(b(e),1)]),_:2},1032,["onClick"]))),128))]),_:1}),p(a,{class:"filter-column",style:{color:"rgb(13, 184, 22)"}},{default:i(()=>[(h(!0),O(N,null,S(c.newFilterOptions,(e,t)=>(h(),s(a,{class:"filter-option",key:t,onClick:y(t=>r.selectNewFilterOption2(e),["stop"])},{default:i(()=>[k(b(e),1)]),_:2},1032,["onClick"]))),128))]),_:1}),p(a,{class:"filter-column",style:{color:"rgb(128, 114, 247)"}},{default:i(()=>[(h(!0),O(N,null,S(c.filterOptions,(e,t)=>(h(),s(a,{class:"filter-option",key:t,onClick:y(t=>r.selectFilterOption(e),["stop"])},{default:i(()=>[k(b(r.sliceFirst(e)),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["onClick"])):g("",!0)]),_:1},8,["class"]),p(a,{class:"outer"},{default:i(()=>[p(B,{class:m(["list-container",c.isFilterOpen?"disabled-scroll":""]),"scroll-y":"true","scroll-top":c.scrollTop,onScroll:r.onListScroll,onTouchstart:r.handleTouchStart,onTouchmove:r.handleTouchMove,onTouchend:r.handleTouchEnd,"lower-threshold":50,onScrolltolower:r.onReachBottom,"show-scrollbar":!1},{default:i(()=>[(h(!0),O(N,null,S(c.placesList,(e,t)=>(h(),s(a,{class:"list-item",key:e.id||t,onClick:t=>r.onListItemClick(e)},{default:i(()=>[r.need2(e)?(h(),s(a,{key:0,class:"triangle-label"},{default:i(()=>[p(d,null,{default:i(()=>[k("需预约")]),_:1})]),_:1})):g("",!0),p(_,{class:"item-image",mode:"aspectFill",src:c.noNet?"":e.img,"lazy-load":!0},null,8,["src"]),p(a,{class:"item-content"},{default:i(()=>[p(d,{class:"item-title"},{default:i(()=>[k(b(e.title),1)]),_:2},1024),e.recomend&&""!==e.recomend?(h(),s(a,{key:0,class:"tag-container"},{default:i(()=>[(h(!0),O(N,null,S(r.getTags(e),(e,t)=>(h(),s(a,{class:"tag",key:t},{default:i(()=>[k(b(e),1)]),_:2},1024))),128))]),_:2},1024)):g("",!0),e.distance?(h(),s(d,{key:1,class:"item-price",style:{"margin-top":"3px",color:"#4782ee"}},{default:i(()=>[k("距离: "+b(e.distance)+"km",1)]),_:2},1024)):g("",!0),e.price&&""!==e.price?(h(),s(d,{key:2,class:"item-price",style:{"margin-top":"3px",color:"#db3838"}},{default:i(()=>[k("价格: "+b(r.getPrice3(e)),1)]),_:2},1024)):g("",!0),p(a,{class:"star-rating",style:{"margin-top":"3px"}},{default:i(()=>[(h(),O(N,null,S(5,t=>p(_,{key:t,src:t-1<Number(e.rate)?"/static/images/star-filled.png":"/static/images/star-empty.png",mode:"aspectFill"},null,8,["src"])),64))]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),c.hasMore?g("",!0):(h(),s(a,{key:0,style:{"text-align":"center",padding:"10px",color:"#999"}},{default:i(()=>[k("没有更多数据了")]),_:1}))]),_:1},8,["class","scroll-top","onScroll","onTouchstart","onTouchmove","onTouchend","onScrolltolower"])]),_:1})]),_:1})}],["__scopeId","data-v-9c107ea4"]]);export{C as default};
